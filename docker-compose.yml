version: "3"

services:
  terrad:
    container_name: terrad
    image: terrarebels/terraclassic.terrad-node:latest-rebel-1
    #pull_policy: always
    environment:
      - CHAINID=rebel-1
      - ENABLE_LCD=true
      - ENABLE_UNSAFE_CORS=false
      - CORS_ALLOWED_ORIGINS=[]
      - CORS_ALLOWED_METHODS=["HEAD", "GET", "POST"]
      - CORS_ALLOWED_HEADERS=["Origin", "Accept", "Content-Type", "X-Requested-With", "X-Server-Time"]
      - TERRAD_STARTUP_PARAMETERS=--x-crisis-skip-assert-invariants
      - MINIMUM_GAS_PRICES=0.05uluna,0.104938usdr,0.15uusd,170.0ukrw
      - MONIKER=rebel-docker-node
      - VALIDATOR_KEYNAME=local
      - VALIDATOR_PASSPHRASE=12345678
      - VALIDATOR_MNENOMIC=torch swamp cancel lift never october child harsh rib aspect luxury word peanut length bamboo hawk material vehicle glue above west random sketch author
      - VALIDATOR_AMOUNT=10000000uluna
      - VALIDATOR_COMMISSION_RATE=0.1
      - VALIDATOR_COMMISSION_RATE_MAX=0.2
      - VALIDATOR_COMMISSION_RATE_MAX_CHANGE=0.01
      - VALIDATOR_MIN_SELF_DELEGATION=1
      - VALIDATOR_GAS=auto
      - VALIDATOR_GAS_ADJUSTMENT=1.4
      - VALIDATOR_FEES=120000uluna
      #Do not make 1 if you donâ€™t know EXACTLY what you are doing 
      - VALIDATOR_AUTO_CONFIG=0
    volumes:
      - terra:/terra
    networks:
      - terra-classic
    ports:
      - "26657:26657"
      - "1317:1317"
      - "9090:9090"
      - "9091:9091"
    command: terrad start
  postgres:
    image: postgres:13
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - terra-classic
    environment:
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: dev
  # redis:
  #   image: redis:latest
  #   networks:
  #     - terra
  #   ports:
  #     - "6379:6379"
  fcd-collector:
    image: terramoney/fcd:2.0.6
    depends_on:
      - terrad
      - postgres
    volumes:
      - ./logs:/app/logs
    networks:
      - terra-classic
    env_file: fcd.env
    command: collector
    restart: unless-stopped
  fcd-api:
    image: terramoney/fcd:2.0.6
    depends_on:
      - terrad
      - postgres
    volumes:
      - ./logs:/app/logs
    networks:
      - terra-classic
    ports:
      - 3060:3060
    env_file: fcd.env
    command: start

networks:
  terra:
    driver: bridge
